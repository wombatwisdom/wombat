---
title: Output
sidebar:
    order: 4
---
import { Aside } from '@astrojs/starlight/components';
import { Tabs, TabItem } from '@astrojs/starlight/components';

An output is a sink where we wish to send our consumed data after applying an optional array
of processors. Only one output is configured at the root of a Wombat config. However, the output can be
a [`broker`](/reference/components/outputs/broker) which combines multiple outputs under a chosen brokering pattern,
or a [`switch`](/reference/components/outputs/switch) which is used to multiplex against different outputs.

An output config section looks like this:

```yaml
output:
  label: my_s3_output

  aws_s3:
    bucket: TODO
    path: '${! metadata("kafka_topic") }/${! json("message.id") }.json'

  # Optional list of processing steps
  processors:
    - mapping: '{"message":this,"meta":{"link_count":this.links.length()}}'
```

## Back Pressure
Wombat outputs apply back pressure to components upstream. This means if your output target starts blocking traffic
Wombat will gracefully stop consuming until the issue is resolved.

## Retrying
When a Wombat output fails to send a message the error is propagated back up to the input, where depending on the
protocol it will either be pushed back to the source as a Noack (e.g. AMQP) or will be reattempted indefinitely with the
commit withheld until success (e.g. Kafka).

It's possible to instead have Wombat indefinitely retry an output until success with a [`retry` output](/reference/components/outputs/retry).
Some other outputs, such as the [`broker` output](/reference/components/outputs/broker), might also retry indefinitely
depending on their configuration.

## Output Processors
Output processors are functions applied to messages just before they are sent to the output. They are entirely optional
but can be used to transform the message content, or to add metadata to the message. For example,
imagine you want to add a count of the number of links in a message to the message itself before sending the message to
an S3 bucket:

```yaml
output:
  aws_s3:
    bucket: TODO
  processors:
    - mapping: |-
        root.message = this
        root.meta.link_count = this.links.length()
```